
# Gulp config 2021 -  Конфиг для Gulp на ES Modules

Сборка включает в себя сервер(*browser-sync*), *pug* (как шаблонизатор html), *sass* (как препроцессор), *rollup* (для сборки js).

## Предполагаемая структура проекта:
```
  .
  ├── dist                 # Папка для скомпилированных файлов - в продакшн
  ├── dev                  # Папка для разработки. `Browser-sync` работает отсюда
  ├── src                  # Исходники проекта
  │   ├── pug              # Pug-файлы
  │   ├── sass             # Sass/scss - файлы
  │   ├── js               # js-файлы
  │   ├── icons            # svg иконки
  │   └── fonts            # Файлы шрифтов
```

## Особенности сборки
### Шрифты
Предполагается, что шрифты будут подготовлены вручную любым удобным инструментом. Я использую [Glyphhanger][glyphhanger], но его установка в систему выходит за рамки `npm install`. Потому таск предполагает только копирование файлов.
### Скрипты
Сборка с помощью Rollup. Babel не подгружает полифилы, потому что они слишком раздувают код.
### Изображения
[Imagemin][gimagemin] с настройками, указанными в конфиге(см ниже) обеспечивает довольно неплохую оптимизацию, но вручную всегда можно сделать лучше. Советую попробовать [Squoosh][squoosh].

## Использование
Склонируйте проект:
```
git clone https://github.com/battlehater/gulp.git #пример для https
```
или скачайте архив.
Установите зависимости:
```
npm i
```
Для запуска разработки:
```
npm start
```
Для сборки в продакшн:
```
npm run build
```
## Настройки
На данном этапе настроек не много, да и не уверен, что они нужны.
Настройки путей, конфигурации модулей находяся в `./gulp/config.js`
Файл экспортирует объект настроек примерно такого вида:
```javascript
{
	"env": variable, //Окружение ('dev' - для разработки или 'prod' - для финальной сборки). Устанавливается при вызове gulp таска с параметром --env [dev|prod]. При вызове без параметра - по умолчанию устанавливается значение dev. См. файл packeage.json -> scripts -> "start" и "build"
	"envFolder": env === 'prod' ? 'dist' : 'dev', // название папки, в зависимости от окружения
	"dev": {}, // объект с общими настройками для тасков в режиме разработки
	"prod": {}, // объект с общими настройками для тасков в режиме сборки
	// комментарии к настройкам здесь же
	"path": {}, // Пути к файлам для исходников, разработки, продакшена и слежения(watch). Можно было объединить dev и prod, а в тасках задавать название в зависимости от окружения(env), но хотелось большей гибкости, потому пути почти полностью повторяются
	//
	// Дальше идут настройки для плагинов, там все понятно.
}
```

[glyphhanger]: https://github.com/filamentgroup/glyphhanger "glyphhanger"
[gimagemin]: https://github.com/sindresorhus/gulp-imagemin "Imagemin"
[squoosh]: https://squoosh.app "Squoosh"
